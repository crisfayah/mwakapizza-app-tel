<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KDS - Pilotage Cuisine</title>
    <style>
        :root {
            --bg-dark: #121212;
            --card-bg: #1e1e1e;
            --text-light: #e0e0e0;
            --accent-orange: #e67e22;
            --accent-green: #27ae60;
            --accent-blue: #3498db;
            --border: #333;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-light);
            margin: 0;
            overflow: hidden;
        }

        /* Navigation Onglets */
        nav {
            display: flex;
            background: #000;
            padding: 10px;
            justify-content: space-around;
            border-bottom: 2px solid var(--border);
        }

        nav button {
            background: none;
            border: none;
            color: #888;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            padding: 10px 20px;
        }

        nav button.active {
            color: white;
            border-bottom: 3px solid var(--accent-orange);
        }

        .tab-content { display: none; height: calc(100vh - 70px); padding: 20px; box-sizing: border-box; }
        .tab-content.active { display: block; }

        /* GRILLE EN COURS (KDS) */
        .kds-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            height: 100%;
        }

        .kds-ticket {
            background: var(--card-bg);
            border: 2px solid var(--border);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .ticket-header {
            padding: 15px;
            border-bottom: 1px solid var(--border);
            background: #252525;
            border-radius: 12px 12px 0 0;
        }

        .ticket-header h2 { margin: 0; font-size: 1.5rem; text-transform: uppercase; }
        .badge-livraison { background: #c0392b; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; margin-top: 5px; display: inline-block; }

        .items-list {
            flex-grow: 1;
            padding: 15px;
            font-size: 1.3rem;
        }

        .pizza-item {
            padding: 10px;
            margin-bottom: 5px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
        }

        /* Matching Visuel */
        .matching {
            background-color: rgba(230, 126, 34, 0.15);
            border-left: 5px solid var(--accent-orange);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        /* Boutons */
        .actions { padding: 15px; display: flex; gap: 10px; }
        .btn {
            flex: 1;
            padding: 20px;
            border: none;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
        }
        .btn-four { background: var(--accent-orange); color: white; }
        .btn-pret { background: var(--accent-green); color: white; display: none; }

        /* Onglets Standards */
        .list-view { background: var(--card-bg); border-radius: 8px; padding: 15px; }
        table { width: 100%; border-collapse: collapse; color: white; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid var(--border); }
    </style>
</head>
<body>

<nav>
    <button onclick="showTab('a-faire')">Ã€ FAIRE</button>
    <button onclick="showTab('en-cours')" class="active">EN COURS</button>
    <button onclick="showTab('termine')">TERMINÃ‰</button>
</nav>

<div id="a-faire" class="tab-content">
    <div class="list-view">
        <table id="table-a-faire">
            <thead>
                <tr>
                    <th>Client</th>
                    <th>Pizzas</th>
                    <th>Type</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="body-a-faire">
                </tbody>
        </table>
    </div>
</div>

<div id="en-cours" class="tab-content active">
    <div class="kds-grid" id="kds-container">
        </div>
</div>

<div id="termine" class="tab-content">
    <div class="list-view">
        <table id="table-termine">
            <thead>
                <tr>
                    <th>Heure</th>
                    <th>Client</th>
                    <th>Contact / Adresse</th>
                    <th>Total</th>
                    <th>RÃ¨glement</th>
                </tr>
            </thead>
            <tbody id="body-termine">
                </tbody>
        </table>
    </div>
</div>

<script>
    // 1. BASE DE DONNÃ‰ES PIZZAS (issue de votre Google Sheet)
    const pizzaCatalog = {
        "MARIA": { cook: 3, prep: 0.15, dressing: false },
        "DANJÃ‰": { cook: 3, prep: 0.15, dressing: true },
        "MAMA": { cook: 3, prep: 0.2, dressing: false },
        "OCHAN": { cook: 4, prep: 0.5, dressing: false },
        "SIRÃˆNE": { cook: 4, prep: 0.5, dressing: true },
        "BIG MACHINE": { cook: 5, prep: 0.5, dressing: false },
        "MWAKA MOON": { cook: 5, prep: 1.5, dressing: false }
        // Ajoutez les autres ici...
    };

    // 2. DONNÃ‰ES DE TEST (Simulant votre base de donnÃ©es)
    let orders = [
        { id: 101, client: "Jean-Pierre", type: "LIVRAISON", pizzas: ["MARIA", "DANJÃ‰", "SIRÃˆNE"], status: "EN_COURS", contact: "0606060606", adresse: "12 rue des Fleurs", total: "45â‚¬", reglement: "CB" },
        { id: 102, client: "Sophie", type: "EMPORTER", pizzas: ["MARIA", "MAMA"], status: "EN_COURS", total: "22â‚¬", reglement: "EspÃ¨ces" },
        { id: 103, client: "Marc", type: "LIVRAISON", pizzas: ["OCHAN", "MARIA", "MARIA", "BIG MACHINE"], status: "EN_COURS", contact: "0707070707", adresse: "Avenue du Port", total: "58â‚¬", reglement: "Lydia" },
        { id: 104, client: "Lucie", type: "EMPORTER", pizzas: ["MAMA"], status: "A_FAIRE" }
    ];

    function showTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        event.currentTarget.classList.add('active');
        render();
    }

    function render() {
        renderAFaire();
        renderEnCours();
        renderTermine();
    }

    function renderAFaire() {
        const body = document.getElementById('body-a-faire');
        body.innerHTML = orders.filter(o => o.status === "A_FAIRE").map(o => `
            <tr>
                <td>${o.client}</td>
                <td>${o.pizzas.join(', ')}</td>
                <td>${o.type}</td>
                <td><button onclick="updateStatus(${o.id}, 'EN_COURS')">Lancer</button></td>
            </tr>
        `).join('');
    }

    function renderEnCours() {
        const container = document.getElementById('kds-container');
        const activeOrders = orders.filter(o => o.status === "EN_COURS").slice(0, 3);
        
        // Calcul pour le Matching
        const allVisiblePizzas = activeOrders.flatMap(o => o.pizzas);
        const pizzaCounts = allVisiblePizzas.reduce((acc, name) => {
            acc[name] = (acc[name] || 0) + 1;
            return acc;
        }, {});

        container.innerHTML = activeOrders.map(o => `
            <div class="kds-ticket">
                <div class="ticket-header">
                    <h2>${o.client}</h2>
                    ${o.type === 'LIVRAISON' ? '<span class="badge-livraison">ðŸšš LIVRAISON</span>' : 'ðŸ¥¡ EMPORTER'}
                </div>
                <div class="items-list">
                    ${o.pizzas.map(p => `
                        <div class="pizza-item ${pizzaCounts[p] > 1 ? 'matching' : ''}">
                            <span>${p}</span>
                            <span>${pizzaCatalog[p]?.dressing ? 'ðŸ¥—' : ''}</span>
                        </div>
                    `).join('')}
                </div>
                <div class="actions">
                    <button id="four-${o.id}" class="btn btn-four" onclick="mettreAuFour(${o.id})">AU FOUR !</button>
                    <button id="pret-${o.id}" class="btn btn-pret" onclick="finaliser(${o.id})">PRÃŠT !</button>
                </div>
            </div>
        `).join('');
    }

    function renderTermine() {
        const body = document.getElementById('body-termine');
        body.innerHTML = orders.filter(o => o.status === "TERMINE").map(o => `
            <tr>
                <td>19:45</td>
                <td>${o.client}</td>
                <td>${o.contact || ''} / ${o.adresse || 'Sur place'}</td>
                <td>${o.total}</td>
                <td>${o.reglement}</td>
            </tr>
        `).join('');
    }

    function mettreAuFour(orderId) {
        const btnFour = document.getElementById(`four-${orderId}`);
        const btnPret = document.getElementById(`pret-${orderId}`);
        
        btnFour.style.display = 'none';
        btnPret.style.display = 'block';
        btnPret.style.opacity = '0.5';
        btnPret.innerText = "CUISSON...";

        // Simulation du temps de cuisson (on prend la plus longue du bon) + 15s de marge
        const order = orders.find(o => o.id === orderId);
        const maxCookTime = Math.max(...order.pizzas.map(p => pizzaCatalog[p]?.cook || 3));
        
        setTimeout(() => {
            btnPret.style.opacity = '1';
            btnPret.innerText = "PRÃŠT !";
        }, maxCookTime * 1000); // En millisecondes pour le test (normalement * 60000)
    }

    function finaliser(orderId) {
        const order = orders.find(o => o.id === orderId);
        order.status = "TERMINE";
        render();
    }

    function updateStatus(id, newStatus) {
        orders.find(o => o.id === id).status = newStatus;
        render();
    }

    // Initialisation
    render();
</script>

</body>
</html>
