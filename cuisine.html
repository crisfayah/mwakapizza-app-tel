<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Mwaka Cuisine - DEBUG MODE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: sans-serif; background: #0b0b0b; color: #fff; padding: 20px; }
        .status-box { background: #1a1a1a; padding: 15px; border-radius: 8px; border: 1px solid #333; margin-bottom: 20px; }
        .error-log { background: #451a1a; color: #ff9999; padding: 15px; border-radius: 8px; display: none; margin-top: 20px; font-family: monospace; }
        .order-card { background: #222; padding: 15px; margin-bottom: 10px; border-left: 10px solid #2ecc71; border-radius: 8px; }
        .loading { color: #f1c40f; font-weight: bold; animation: blink 1s infinite; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body>

    <h1>üë®‚Äçüç≥ Cuisine Mwaka</h1>
    
    <div class="status-box">
        √âtat de la connexion : <span id="connStatus" class="loading">Tentative de connexion au Cloud...</span>
    </div>

    <div id="errorLog" class="error-log"></div>

    <div id="ordersContainer"></div>

    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

    <script>
        // Ta configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCxyNbWyEAVot0sDzBzUdbqp4tQ2jBWMS0",
            authDomain: "mwakaphone-e8c5b.firebaseapp.com",
            projectId: "mwakaphone-e8c5b",
            storageBucket: "mwakaphone-e8c5b.firebasestorage.app",
            messagingSenderId: "258049374795",
            appId: "1:258049374795:web:bc7863ce2f86d8a6c8abce"
        };

        // Initialisation avec gestion d'erreur
        try {
            firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();
            
            // TEST : On enl√®ve le .orderBy temporairement pour forcer l'affichage
            db.collection("commandes")
              .where("status", "==", "en_attente")
              .onSnapshot((snapshot) => {
                  const statusEl = document.getElementById('connStatus');
                  statusEl.innerText = "Connect√© ‚úÖ";
                  statusEl.classList.remove('loading');
                  statusEl.style.color = "#2ecc71";

                  const container = document.getElementById('ordersContainer');
                  container.innerHTML = "";

                  if (snapshot.empty) {
                      container.innerHTML = "<p>Aucune commande en attente.</p>";
                      return;
                  }

                  snapshot.forEach((doc) => {
                      const o = doc.data();
                      const div = document.createElement('div');
                      div.className = 'order-card';
                      div.innerHTML = `<strong>${o.clientName}</strong> - ${o.type}<br>Total: ${o.total}‚Ç¨`;
                      container.appendChild(div);
                  });
              }, (error) => {
                  // SI FIREBASE RENVOIE UNE ERREUR
                  console.error("Erreur Firestore:", error);
                  const errorLog = document.getElementById('errorLog');
                  errorLog.style.display = 'block';
                  errorLog.innerText = "ERREUR FIREBASE : " + error.message + "\nCode: " + error.code;
                  
                  const statusEl = document.getElementById('connStatus');
                  statusEl.innerText = "√âCHEC ‚ùå";
                  statusEl.style.color = "#e74c3c";
              });

        } catch (e) {
            document.getElementById('errorLog').style.display = 'block';
            document.getElementById('errorLog').innerText = "ERREUR INITIALISATION : " + e.message;
        }
    </script>
</body>
</html>
